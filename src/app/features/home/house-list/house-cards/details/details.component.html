<ngx-spinner size="medium" color="#fff" type="ball-scale-multiple">
  <p style="font-size: 20px; color: white">Loading...</p>
</ngx-spinner>
<article class="page-container" *ngIf="housingLocation">
  <!-- A imagem é envolvida por um container para posicionar o botão -->
  <div class="listing-photo-container">
    <img
      class="listing-photo housing-image"
      [src]="housingLocation.photo"
      alt="Exterior photo of {{ housingLocation.name }}"
    />
    <!-- BOTÃO DE FAVORITAR ADICIONADO -->
    <button
      mat-icon-button
      class="favorite-details-button"
      (click)="toggleFavorite()"
      [ngClass]="{ favorited: isFavorited() }"
      [matTooltip]="
        isFavorited() ? 'Remove from favorites' : 'Add to favorites'
      "
      type="button"
    >
      <mat-icon>
        {{ isFavorited() ? "favorite" : "favorite_border" }}
      </mat-icon>
    </button>
  </div>

  <section class="listing-description" *ngIf="housingLocation">
    <h2 class="listing-heading">{{ housingLocation.name }}</h2>
    <p class="listing-location">
      {{ housingLocation.city }}, {{ housingLocation.state }}
    </p>
  </section>

  <!-- Seção de informações adicionais -->
  <section class="listing-features">
    <h2 class="section-heading">About this housing location</h2>
    <ul>
      <li>✔ Units available: {{ housingLocation.availableUnits }}</li>
      <li>✔ Does this location have wifi: {{ housingLocation.wifi }}</li>
      <li>✔ Does this location have laundry: {{ housingLocation.laundry }}</li>
    </ul>
  </section>

  <!-- Formulário de aplicação -->
  <section class="listing-apply">
    <h2 class="section-heading">Apply now to live here</h2>
    <form
      class="apply-form"
      [formGroup]="applyForm"
      (submit)="submitApplication()"
    >
      <label for="name">Name</label>
      <input id="name" type="text" formControlName="name" class="form-input" />

      <label for="email">Email</label>
      <input
        id="email"
        type="email"
        formControlName="email"
        class="form-input"
      />

      <label for="phone">Phone</label>
      <input
        id="phone"
        type="text"
        formControlName="phone"
        class="form-input"
      />

      <label for="location">Location</label>
      <input
        id="location"
        type="text"
        formControlName="location"
        class="form-input"
      />

      <!-- SELL -->
      <ng-container *ngIf="housingLocation?.typeOfBusiness === 'sell'">
        <label for="visit-date">Date of Visit</label>
        <input
          id="visit-date"
          type="date"
          formControlName="visitDate"
          class="form-input"
          [min]="today"
        />
        <!-- Adicionar mensagem de erro -->
        <div
          *ngIf="
            applyForm.get('visitDate')?.invalid &&
            (applyForm.get('visitDate')?.dirty ||
              applyForm.get('visitDate')?.touched)
          "
          class="error-message"
        >
          <div *ngIf="applyForm.get('visitDate')?.hasError('required')">
            Visit date is required.
          </div>
        </div>

        <label for="visit-time">Visit Time</label>
        <mat-form-field class="form-field">
          <mat-select formControlName="visitTime">
            <mat-option value="" disabled>Select a time</mat-option>
            <!-- Altera para usar a lista de horários filtrados -->
            <mat-option *ngFor="let hour of filteredVisitHours" [value]="hour">
              {{ hour }}
            </mat-option>
          </mat-select>
          <mat-error
            *ngIf="
              applyForm.get('visitTime')?.hasError('required') &&
              applyForm.get('visitTime')?.touched
            "
          >
            Visit time is required.
          </mat-error>
        </mat-form-field>
      </ng-container>

      <!-- RENT -->
      <ng-container *ngIf="housingLocation?.typeOfBusiness === 'rent'">
        <label for="check-in-date">Check-in Date</label>
        <input
          id="check-in-date"
          type="date"
          formControlName="checkInDate"
          class="form-input"
          [min]="today"
        />
        <!-- Adicionar mensagem de erro -->
        <div
          *ngIf="
            applyForm.get('checkInDate')?.invalid &&
            (applyForm.get('checkInDate')?.dirty ||
              applyForm.get('checkInDate')?.touched)
          "
          class="error-message"
        >
          <div *ngIf="applyForm.get('checkInDate')?.hasError('required')">
            Check-in date is required.
          </div>
        </div>

        <label for="check-out-date">Check-out Date</label>
        <input
          id="check-out-date"
          type="date"
          formControlName="checkOutDate"
          class="form-input"
          [min]="applyForm.get('checkInDate')?.value || today"
        />
        <!-- Adicionar mensagem de erro -->
        <div
          *ngIf="
            applyForm.get('checkOutDate')?.invalid &&
            (applyForm.get('checkOutDate')?.dirty ||
              applyForm.get('checkOutDate')?.touched)
          "
          class="error-message"
        >
          <div *ngIf="applyForm.get('checkOutDate')?.hasError('required')">
            Check-out date is required.
          </div>
        </div>
      </ng-container>

      <button type="submit" class="primary">Apply now</button>
    </form>
  </section>
</article>

<!-- Seção de Reviews agora usa o componente app-reviews -->
<app-reviews
  *ngIf="housingLocation?.id"
  [housingLocationId]="housingLocation!.id"
  [currentUser]="currentUser"
></app-reviews>
