<form [formGroup]="filterForm">
  <mat-sidenav-container class="filter-sidenav-container">
    <mat-sidenav #sidenav mode="over" position="start" class="filter-sidenav">
      <div class="sidenav-header">
        <h3>Filters</h3>
        <button mat-icon-button (click)="sidenav.close()" matTooltip="Close">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="filters-panel-content">
        <div class="filters-panel-form">
          <mat-form-field appearance="outline">
            <mat-label>Property type</mat-label>
            <mat-select formControlName="propertyType">
              @for (type of propertyTypes; track type) {
              <mat-option [value]="type === 'No Preference' ? '' : type">
                {{ type | titlecase }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>

          <label class="mat-body-strong">Transaction Type</label>
          <mat-button-toggle-group
            formControlName="typeOfBusiness"
            class="filtro-roxo-toggle"
            aria-label="Transaction Type"
          >
            <mat-button-toggle value="sell">Sell</mat-button-toggle>
            <mat-button-toggle value="rent">Rent</mat-button-toggle>
          </mat-button-toggle-group>

          <label class="mat-body-strong">Amenities</label>
          <div class="filtro-roxo-checkbox-group">
            <mat-checkbox formControlName="wifi">Wi-Fi</mat-checkbox>
            <mat-checkbox formControlName="laundry">Laundry</mat-checkbox>
          </div>
        </div>

        @if(filterForm.dirty) {
        <div class="clear-filters-wrapper">
          <button
            mat-raised-button
            class="clear-filters-button"
            (click)="clearFilters()"
          >
            <mat-icon>delete_sweep</mat-icon>
            Clear Filters
          </button>
        </div>
        }
      </div>
    </mat-sidenav>

    <mat-sidenav-content>
      <div class="home-filter-wrapper">
        <mat-form-field
          appearance="outline"
          class="filters-form-container__city-filter compact-form-field"
        >
          <mat-label>Filter by city</mat-label>
          <input matInput formControlName="city" placeholder="Ex: Curitiba" />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <button
          mat-raised-button
          (click)="sidenav.open()"
          class="create-button compact-button"
        >
          <mat-icon>filter_list</mat-icon>
          Filters
        </button>

        @if(filterForm.dirty) {
        <button
          mat-icon-button
          (click)="clearFilters()"
          matTooltip="Clear filters"
          class="clear-icon-button"
        >
          <mat-icon>close</mat-icon>
        </button>
        }

        <div class="create-wrapper">
          @if(currentUserRole === 'Admin' || currentUserRole === 'Manager' ||
          currentUserRole === 'Realtor') {
          <!-- CORREÇÃO: Aplicando a classe e a diretiva corretas -->
          <button
            mat-flat-button
            class="main-action-btn"
            (click)="openCreateHouse()"
          >
            + Create a House
          </button>
          }
          <!-- CORREÇÃO: Usando mat-flat-button para consistência -->
          <button
            mat-flat-button
            class="main-action-btn"
            routerLink="/favorites"
            aria-label="Favorites"
          >
            <mat-icon>favorite_border</mat-icon>
            Favorites
          </button>

          <!-- BOTÃO DE COMPARAÇÃO ADICIONADO -->
          <!-- CORREÇÃO: Usando mat-flat-button para consistência -->
          <button
            mat-flat-button
            class="main-action-btn"
            (click)="toggleCompareMode()"
            [class.active]="compareMode"
          >
            <mat-icon>compare_arrows</mat-icon>
            Compare Houses
          </button>
        </div>
      </div>

      <section class="housing-location-container">
        @for (housingLocation of pagedLocationList; track housingLocation.id) {
        <app-house-cards
          [housingLocation]="housingLocation"
          (houseUpdated)="loadLocations()"
          [compareMode]="compareMode"
        />
        }
      </section>

      <mat-paginator
        [length]="filteredLocationList.length"
        [pageSize]="pageSize"
        [pageSizeOptions]="[5, 10, 20, 50]"
        (page)="onPageChange($event)"
      >
      </mat-paginator>
      <app-legal-info></app-legal-info>
    </mat-sidenav-content>
  </mat-sidenav-container>
</form>

<!-- ADICIONE A BANDEJA DE COMPARAÇÃO AQUI -->
<app-compare-tray></app-compare-tray>
