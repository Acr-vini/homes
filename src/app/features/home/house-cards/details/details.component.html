<article class="page-container" *ngIf="housingLocation">
  <!-- Seção da imagem e descrição -->
  <img
    class="listing-photo housing-image"
    [src]="housingLocation.imageUrl || housingLocation.photo"
    [alt]="'Exterior photo of ' + housingLocation.name"
  />

  <section class="listing-description" *ngIf="housingLocation">
    <h2 class="listing-heading">{{ housingLocation.name }}</h2>
    <p class="listing-location">
      {{ housingLocation.city }}, {{ housingLocation.state }}
    </p>
  </section>

  <!-- Seção de informações adicionais -->
  <section class="listing-features">
    <h2 class="section-heading">About this housing location</h2>
    <ul>
      <li>✔ Units available: {{ housingLocation.availableUnits }}</li>
      <li>✔ Does this location have wifi: {{ housingLocation.wifi }}</li>
      <li>✔ Does this location have laundry: {{ housingLocation.laundry }}</li>
    </ul>
  </section>

  <!-- Formulário de aplicação -->
  <section class="listing-apply">
    <h2 class="section-heading">Apply now to live here</h2>
    <form
      class="apply-form"
      [formGroup]="applyForm"
      (submit)="submitApplication()"
    >
      <label for="name">Name</label>
      <input id="name" type="text" formControlName="name" class="form-input" />

      <label for="email">Email</label>
      <input
        id="email"
        type="email"
        formControlName="email"
        class="form-input"
      />

      <label for="phone">Phone</label>
      <input
        id="phone"
        type="text"
        formControlName="phone"
        class="form-input"
      />

      <label for="location">Location</label>
      <input
        id="location"
        type="text"
        formControlName="location"
        class="form-input"
      />

      <!-- SELL -->
      <ng-container *ngIf="housingLocation?.typeOfBusiness === 'sell'">
        <label for="visit-date">Date of Visit</label>
        <input
          id="visit-date"
          type="date"
          formControlName="visitDate"
          class="form-input"
          [min]="today"
        />

        <label for="visit-time">Visit Time</label>
        <mat-form-field class="full-width">
          <mat-select formControlName="visitTime" required>
            <mat-option value="" disabled>Select a time</mat-option>
            <mat-option *ngFor="let hour of visitHours" [value]="hour">
              {{ hour }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>

      <!-- RENT -->
      <ng-container *ngIf="housingLocation?.typeOfBusiness === 'rent'">
        <label for="check-in-date">Check-in Date</label>
        <input
          id="check-in-date"
          type="date"
          formControlName="checkInDate"
          class="form-input"
          [min]="today"
        />

        <label for="check-out-date">Check-out Date</label>
        <input
          id="check-out-date"
          type="date"
          formControlName="checkOutDate"
          class="form-input"
          [min]="applyForm.get('checkInDate')?.value || today"
        />
      </ng-container>

      <button type="submit" class="primary">Apply now</button>
    </form>
  </section>
</article>

<mat-card class="listing-reviews-card">
  <mat-card-title>Reviews</mat-card-title>
  <mat-card-content>
    <div *ngIf="reviews.length; else noReviews">
      <div *ngFor="let review of reviews" class="review">
        <div class="review-header">
          <strong>{{ review.userName }}</strong>
          <span class="review-rating">
            <mat-icon *ngFor="let star of [].constructor(review.rating)"
              >star</mat-icon
            >
          </span>
          <span class="review-date">{{ review.date }}</span>
          <button
            *ngIf="canEditReviews"
            mat-icon-button
            color="primary"
            (click)="editReview(review)"
            [matTooltip]="'Edit Review'"
            aria-label="Edit Review"
          >
            <mat-icon>edit</mat-icon>
          </button>
          <button
            *ngIf="canEditReviews"
            mat-icon-button
            color="warn"
            (click)="deleteReview(review)"
            [matTooltip]="'Delete Review'"
            aria-label="Delete Review"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        <div class="review-comment">{{ review.comment }}</div>
      </div>
    </div>
    <ng-template #noReviews>
      <p>No reviews yet.</p>
    </ng-template>
  </mat-card-content>
  <mat-divider></mat-divider>
  <mat-card-content>
    <form
      [formGroup]="reviewForm"
      (ngSubmit)="submitReview()"
      class="review-form"
    >
      <label for="userName">Your Name</label>
      <input id="userName" formControlName="userName" class="form-input" />

      <label>Rating</label>
      <div class="star-rating">
        <mat-icon
          *ngFor="let star of [1, 2, 3, 4, 5]"
          (click)="setRating(star)"
          [ngClass]="{ active: star <= (reviewForm.get('rating')?.value ?? 0) }"
          >star</mat-icon
        >
      </div>

      <label for="comment">Comment</label>
      <textarea
        id="comment"
        formControlName="comment"
        class="form-input"
      ></textarea>

      <button type="submit" class="primary">Submit Review</button>
    </form>
  </mat-card-content>
</mat-card>
